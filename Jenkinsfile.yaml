pipeline:
  agent: any

  environment:
    DEPLOY_SERVER: "172.31.5.20"
    DEPLOY_USER: "ec2-user"
    DEPLOY_PATH: "/opt/tomcat/webapps"
    SSH_KEY: "/var/lib/jenkins/.ssh/project.pem"

  stages:
    - stage: Checkout
      steps:
        - script: |
            git clone -b develop https://github.com/Black-Sparkles/NumberGuessGame.git .

    - stage: Build
      steps:
        - script: |
            mvn clean package

    - stage: Deploy
      steps:
        - script: |
            scp -o StrictHostKeyChecking=no -i ${SSH_KEY} \
            target/*.war ${DEPLOY_USER}@${DEPLOY_SERVER}:${DEPLOY_PATH}/NumberGuessGame.war
